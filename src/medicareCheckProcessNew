@startuml
mainframe 改造后的登记流程
actor 操作员
前端 -> Agent: 登记
Agent -> 收费端: 登记
alt 不需要走医保平台
    收费端 --> Agent: 无需Agent进行医保操作
else 需要走医保平台
    收费端 -> 医保中心: 登记
    医保中心 -> 医保中心: 创建登记单
    alt 不需要进行医保登记
        医保中心 --> 收费端: 返回登记结果
        收费端 --> Agent: 无需Agent进行医保操作
    else 需要进行医保登记
        医保中心 -> 医保中心: 组装医保登记入参
        alt 可以脱卡登记
            医保中心 -> 医保: 进行医保登记
            医保 --> 医保中心:
            医保中心 -> 医保中心: 解析医保登记出参
            医保中心 --> 收费端: 返回登记结果
            收费端 --> Agent: 无需Agent进行医保操作
        else 不能脱卡登记
            医保中心 --> 收费端: 返回医保登记入参
            收费端 --> Agent: 返回医保登记入参
            Agent -> 医保: 进行医保登记
            医保 --> Agent: 返回医保登记出参
            Agent -> 收费端: 解析医保登记出参
            收费端 -> 医保中心: 解析医保登记出参
            医保中心 --> 收费端: 返回登记结果
            收费端 --> Agent: 返回登记结果
        end
    end
end
Agent -> Agent: 后续流程
Agent --> 前端

@enduml